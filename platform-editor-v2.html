<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="oaXq_J3EPKnLlGQ8OG58OdgcaB1WmANiktPfNdCZrZM" />
    <title>Pinleaf Forge - Platform Specification Editor</title>
    <link rel="stylesheet" href="css/platform-editor.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Pinleaf Forge</h1>
            <p>Embedded Platform Specification Editor</p>
        </div>
        
        <div class="content">
            <div class="note" style="background: linear-gradient(135deg, #e7f3ff 0%, #f0f8ff 100%); border-left: 4px solid #667eea; padding: 20px; margin-bottom: 25px;">
                <h3 style="margin-bottom: 12px; color: #667eea; font-size: 1.1em;">üöÄ What is Pinleaf Forge?</h3>
                <p style="margin-bottom: 10px; line-height: 1.6;">
                    <strong>Pinleaf Forge</strong> is an open-source, web-based editor for defining and visualizing microcontroller/processor platform specifications.
                    Built for embedded developers, hobbyists, and teams maintaining hardware catalogs, it combines:
                </p>
                <ul style="margin-left: 20px; margin-bottom: 10px; line-height: 1.8;">
                    <li><strong>AI-assisted data population</strong> ‚Äî Generate research prompts for tools like Copilot/ChatGPT to fetch accurate specs (CPU, RAM, wireless, interfaces, etc.), then import the JSON directly.</li>
                    <li><strong>Visual pin capability matrix</strong> ‚Äî Drag-to-reorder rows for physical layout matching, editable pin names, headers, and color-coded toggle buttons for every capability (GPIO, ADC, PWM, UART, SPI, I2C, power pins, interrupts, etc.).</li>
                    <li><strong>Structured JSON export</strong> ‚Äî Clean, standardized output ready for databases, code generation, PlatformIO custom boards, Wokwi simulations, or your own automation workflows.</li>
                    <li><strong>Multi-header support</strong> ‚Äî Define multiple connectors (J1, J2, etc.) for complex boards with separated power, I/O, and communication headers.</li>
                </ul>
                <p style="margin-top: 10px; font-style: italic; color: #555;">
                    No more manual datasheet hunting or messy spreadsheets‚Äîforge complete, accurate platform definitions with ease. Perfect for IoT prototyping, education, documentation, or building internal MCU reference libraries.
                </p>
            </div>
            
            <div class="note">
                <strong>Platform vs hwrev vs Role:</strong><br/>
                <strong>Platform</strong> = CPU specifications (what processor does)<br/>
                <strong>hwrev</strong> = Board specifications (pinout, physical layout)<br/>
                <strong>Role</strong> = Automation behavior (defined in LadderLogicEditor, not here)
            </div>

            <form id="platformForm">
                <!-- Generate Research Prompt -->
                <div class="form-section">
                    <h2>üîç Step 1: Generate Research Prompt</h2>
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                        Enter the platform name below and click "Generate Prompt". Copy the generated prompt and paste it to Copilot Chat.
                    </p>
                    <div class="form-group">
                        <label for="platformSearchInput">Platform Name</label>
                        <input type="text" id="platformSearchInput" placeholder="e.g., ESP32-C3, STM32F103, Renesas R7FA6M5BH2CBG">
                    </div>
                    <button type="button" class="primary" onclick="generateResearchPrompt()">üìã Generate & Copy Prompt</button>
                    
                    <div id="generatedPromptArea" style="display: none; margin-top: 15px;">
                        <label style="font-weight: bold; color: #28a745;">‚úÖ Prompt Generated & Copied to Clipboard!</label>
                        <p style="font-size: 0.9em; color: #666; margin-top: 8px;">
                            Paste this prompt in Copilot Chat. Copilot will return JSON that you can paste in Step 2 below.
                        </p>
                        <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 12px; margin-top: 10px; max-height: 200px; overflow-y: auto;">
                            <pre id="promptPreview" style="margin: 0; white-space: pre-wrap; font-size: 0.85em;"></pre>
                        </div>
                    </div>
                </div>

                <!-- Import JSON Response -->
                <div class="form-section">
                    <h2>üì• Step 2: Import Copilot's JSON Response</h2>
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                        Paste the JSON response from Copilot here and click "Import JSON"
                    </p>
                    <div class="form-group">
                        <textarea id="pasteJsonInput" rows="8" placeholder='Paste Copilot&#39;s JSON response here...'></textarea>
                    </div>
                    <button type="button" class="primary" onclick="parseAndFillForm()">üì• Import JSON & Fill Form</button>
                </div>

                <!-- Platform Basics -->
                <div class="form-section">
                    <h2>üìã Platform Basics</h2>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="platformId">Platform ID *</label>
                            <input type="text" id="platformId" required placeholder="esp32c3">
                        </div>
                        <div class="form-group">
                            <label for="platformName">Platform Name *</label>
                            <input type="text" id="platformName" required placeholder="ESP32-C3">
                        </div>
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="websiteUrl">Manufacturer Website</label>
                            <input type="text" id="websiteUrl" placeholder="https://www.espressif.com/en/products/socs/esp32-c3">
                        </div>
                        <div class="form-group">
                            <label for="skuNumber">SKU / Part Number</label>
                            <input type="text" id="skuNumber" placeholder="ESP32-C3-WROOM-02">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" rows="3" placeholder="What is this platform? What use cases is it good for?"></textarea>
                    </div>
                </div>

                <!-- CPU Specifications -->
                <div class="form-section">
                    <h2>‚öôÔ∏è CPU Specifications</h2>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="architecture">Architecture *</label>
                            <input type="text" id="architecture" required placeholder="e.g., ARM Cortex-M33, Xtensa, AVR">
                        </div>
                        <div class="form-group">
                            <label for="cores">CPU Cores *</label>
                            <input type="number" id="cores" required min="1" placeholder="1">
                        </div>
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="frequency">Frequency (MHz) *</label>
                            <input type="number" id="frequency" required min="1" placeholder="240">
                        </div>
                        <div class="form-group">
                            <label for="ramKb">RAM (KB) *</label>
                            <input type="number" id="ramKb" required min="1" placeholder="512">
                        </div>
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="flashKb">Flash (KB) *</label>
                            <input type="number" id="flashKb" required min="1" placeholder="4096">
                        </div>
                        <div class="form-group">
                            <label for="gpioTotal">Total GPIO Pins</label>
                            <input type="number" id="gpioTotal" placeholder="22">
                        </div>
                    </div>
                </div>

                <!-- System Capabilities -->
                <div class="form-section">
                    <h2>üîå System Capabilities</h2>
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">Select the system-level peripherals and features available on this platform</p>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="wifi">WiFi *</label>
                            <select id="wifi" required>
                                <option value="">-- Select --</option>
                                <option value="none">None</option>
                                <option value="802.11b/g/n">802.11b/g/n (WiFi 4)</option>
                                <option value="802.11b/g/n/ac">802.11b/g/n/ac (WiFi 5)</option>
                                <option value="WiFi 6">WiFi 6 (802.11ax)</option>
                                <option value="WiFi 7">WiFi 7 (802.11be)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ble">Bluetooth LE *</label>
                            <select id="ble" required>
                                <option value="">-- Select --</option>
                                <option value="none">None</option>
                                <option value="5.0">BLE 5.0</option>
                                <option value="5.1">BLE 5.1</option>
                                <option value="5.2">BLE 5.2</option>
                                <option value="5.3">BLE 5.3</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label style="font-weight: bold; margin-bottom: 10px;">Analog/Digital Channels</label>
                        <div class="grid-2" style="max-width: 400px;">
                            <div class="form-group" style="margin-bottom: 10px;">
                                <label for="adcChannels">ADC Channels</label>
                                <input type="number" id="adcChannels" min="0" placeholder="0" style="width: 100px;">
                            </div>
                            <div class="form-group" style="margin-bottom: 10px;">
                                <label for="pwmChannels">PWM Channels</label>
                                <input type="number" id="pwmChannels" min="0" placeholder="0" style="width: 100px;">
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label style="font-weight: bold; margin-bottom: 10px;">Communication Interfaces (click to toggle)</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                            <button type="button" class="feature-toggle-btn" data-feature="i2c" onclick="toggleSystemFeature(this)">
                                <span class="toggle-icon">‚òê</span> I2C
                            </button>
                            <button type="button" class="feature-toggle-btn" data-feature="spi" onclick="toggleSystemFeature(this)">
                                <span class="toggle-icon">‚òê</span> SPI
                            </button>
                            <button type="button" class="feature-toggle-btn" data-feature="uart" onclick="toggleSystemFeature(this)">
                                <span class="toggle-icon">‚òê</span> UART
                            </button>
                            <button type="button" class="feature-toggle-btn" data-feature="can" onclick="toggleSystemFeature(this)">
                                <span class="toggle-icon">‚òê</span> CAN
                            </button>
                            <button type="button" class="feature-toggle-btn" data-feature="i2s" onclick="toggleSystemFeature(this)">
                                <span class="toggle-icon">‚òê</span> I2S
                            </button>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label style="font-weight: bold; margin-bottom: 10px;">USB Ports</label>
                        <div class="grid-2" style="max-width: 600px;">
                            <div class="form-group" style="margin-bottom: 10px;">
                                <label for="usb1Count">USB 1.x Count</label>
                                <input type="number" id="usb1Count" min="0" placeholder="0" style="width: 100px;">
                            </div>
                            <div class="form-group" style="margin-bottom: 10px;">
                                <label for="usb2Count">USB 2.0 Count</label>
                                <input type="number" id="usb2Count" min="0" placeholder="0" style="width: 100px;">
                            </div>
                            <div class="form-group" style="margin-bottom: 10px;">
                                <label for="usb3Count">USB 3.0 Count</label>
                                <input type="number" id="usb3Count" min="0" placeholder="0" style="width: 100px;">
                            </div>
                            <div class="form-group" style="margin-bottom: 10px;">
                                <label for="usb4Count">USB 4.0 Count</label>
                                <input type="number" id="usb4Count" min="0" placeholder="0" style="width: 100px;">
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label style="font-weight: bold; margin-bottom: 10px;">System Features (click to toggle)</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                            <button type="button" class="feature-toggle-btn" data-feature="ethernet" onclick="toggleSystemFeature(this)">
                                <span class="toggle-icon">‚òê</span> Ethernet
                            </button>
                            <button type="button" class="feature-toggle-btn" data-feature="sdcard" onclick="toggleSystemFeature(this)">
                                <span class="toggle-icon">‚òê</span> SD Card
                            </button>
                            <button type="button" class="feature-toggle-btn" data-feature="rtc" onclick="toggleSystemFeature(this)">
                                <span class="toggle-icon">‚òê</span> RTC
                            </button>
                            <button type="button" class="feature-toggle-btn" data-feature="touchscreen" onclick="toggleSystemFeature(this)">
                                <span class="toggle-icon">‚òê</span> Touchscreen
                            </button>
                            <button type="button" class="feature-toggle-btn" data-feature="camera" onclick="toggleSystemFeature(this)">
                                <span class="toggle-icon">‚òê</span> Camera Interface
                            </button>
                            <button type="button" class="feature-toggle-btn" data-feature="display" onclick="toggleSystemFeature(this)">
                                <span class="toggle-icon">‚òê</span> Display Interface
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Pin Capability Matrix (Dev Board Pinout) -->
                <div class="form-section">
                    <h2>üìç Pin Capability Matrix (Dev Board)</h2>
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">Click on capability buttons to assign functions to each pin. Active capabilities are highlighted in color.</p>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: bold; margin-bottom: 10px;">Number of Pins on Dev Board</label>
                        <input type="number" id="totalPinsInput" min="1" value="22" placeholder="22" style="width: 120px;">
                        <button type="button" class="primary" style="margin-left: 10px;" onclick="generatePinRows()">üìå Generate Pin Rows</button>
                        <button type="button" class="primary" style="margin-left: 10px;" onclick="showSortOptions()">üîÄ Sort Pins</button>
                    </div>

                    <div style="background: #667eea; color: white; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-weight: bold; display: flex; gap: 8px; align-items: center;">
                        <span class="sort-header" style="width: 70px; min-width: 70px; text-align: center;" onclick="sortPins('header')">Header</span>
                        <span class="sort-header" style="width: 120px; min-width: 120px;" onclick="sortPins('group')">Group</span>
                        <span class="sort-header" style="width: 120px; min-width: 120px;" onclick="sortPins('varalias')">Var Alias</span>
                        <span class="sort-header" style="width: 70px; min-width: 70px; text-align: center;" onclick="sortPins('physical')">Physical</span>
                        <span class="sort-header" style="width: 140px; min-width: 140px;" onclick="sortPins('name')">Pin Name</span>
                        <span style="flex: 1;">Capabilities</span>
                    </div>

                    <div class="pinout-display" id="pinoutDisplay">
                        <!-- Generated dynamically -->
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <button type="button" class="primary" onclick="addPinRow()">‚ûï Add Pin Row</button>
                    </div>
                </div>

                <!-- Build & Toolchain Info -->
                <div class="form-section">
                    <h2>üõ†Ô∏è Build & Toolchain</h2>
                    
                    <div class="form-group">
                        <label for="toolchain">Toolchain *</label>
                        <input type="text" id="toolchain" required placeholder="e.g., ESP-IDF, Arduino IDE, STM32CubeIDE, PlatformIO, Keil MDK">
                        <small style="color: #666; font-size: 0.85em; display: block; margin-top: 5px;">
                            Common options: ESP-IDF, Arduino IDE, Simplicity Studio, STM32CubeIDE, PlatformIO, Keil MDK, IAR Embedded Workbench
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">Additional Notes</label>
                        <textarea id="notes" rows="3" placeholder="Any other important information..."></textarea>
                    </div>
                </div>

                <!-- JSON Preview -->
                <div class="form-section">
                    <h2>üìÑ JSON Output</h2>
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">This is what will be saved to <code>platforms/&lt;id&gt;.json</code></p>
                    <div class="json-preview" id="preview">{}</div>
                </div>

                <!-- Quick Pinout Preview -->
                <div class="form-section">
                    <h2>üìå Quick Pinout Preview</h2>
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                        Quick preview of your pinout layout. Click "Generate Pinout Leaf" for full customization options.
                    </p>
                    <div style="text-align: center; background: white; padding: 20px; border-radius: 8px; border: 2px solid #ddd; min-height: 200px;">
                        <div id="quickPinoutPreview" style="display: inline-block;"></div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button type="button" class="primary" style="background: #28a745" onclick="downloadJSON()">‚¨áÔ∏è Download JSON File</button>
                    <button type="button" class="primary" style="background: #e67e22" onclick="openPinoutLeafGenerator()">üìÑ Generate Pinout Leaf</button>
                    <button type="reset" style="background: #999; color: white;">üîÑ Clear Form</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modular JavaScript - Load in correct order -->
    <script src="js/platform-editor-core.js"></script>
    <script src="js/prompt-generator.js"></script>
    <script src="js/json-handler.js"></script>
    <script src="js/pin-matrix.js"></script>
    <script src="js/data-collector.js"></script>
</body>
</html>